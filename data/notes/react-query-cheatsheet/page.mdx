---
title: 'React Query å¸¸ç”¨æ–¹æ³•ç¸½æ•´ç†'
description: 'æ•´ç† @tanstack/react-query çš„æ‰€æœ‰å¸¸ç”¨æ–¹æ³•èˆ‡ä½¿ç”¨æƒ…å¢ƒï¼Œé©åˆä¸­å¤§å‹ React å°ˆæ¡ˆå¿«é€ŸæŸ¥é–±ã€‚'
tags: ['react-query', 'TanStack', 'è³‡æ–™åŒæ­¥', 'å¿«å–ç®¡ç†', 'ç‹€æ…‹ç®¡ç†']
date: '2025-06-16'
---

# ğŸ§  React Query å¸¸ç”¨æ–¹æ³•ç¸½æ•´ç†

React Query æ˜¯ç¾ä»£ React å°ˆæ¡ˆä¸­éå¸¸å¼·å¤§çš„ã€Œä¼ºæœå™¨ç‹€æ…‹ç®¡ç†å·¥å…·ã€ï¼Œæœ¬ç¯‡æ•´ç†æœ€å¸¸ç”¨çš„ Hook èˆ‡å‡½å¼å°ç…§ã€ä½¿ç”¨æƒ…å¢ƒã€å¯¦å‹™æ‡‰ç”¨æ–¹å¼ã€‚

## ğŸ“¦ 1. useQuery â€“ æŸ¥è©¢è³‡æ–™ï¼ˆGETï¼‰

```tsx
import { useQuery } from '@tanstack/react-query';

const { data, isLoading, error } = useQuery({
  queryKey: ['todos'],
  queryFn: () => fetch('/api/todos').then((res) => res.json()),
});
```

- `queryKey`: å¿«å–çš„å”¯ä¸€éµå€¼
- `queryFn`: æŸ¥è©¢è³‡æ–™çš„æ–¹æ³•ï¼ˆå¯æ­é… axios/fetchï¼‰
- è‡ªå‹•è™•ç†ï¼š`isLoading`, `error`, `data`

## ğŸ§¨ 2. useMutation â€“ ä¿®æ”¹/é€å‡ºè³‡æ–™ï¼ˆPOST / PUT / DELETEï¼‰

```tsx
const mutation = useMutation({
  mutationFn: (newTodo) => axios.post('/api/todos', newTodo),
  onSuccess: () => {
    queryClient.invalidateQueries(['todos']); // æ›´æ–°å¿«å–
  },
});
```

- `mutationFn`: è¦é€å‡ºçš„ API å‡½å¼
- `onSuccess`: æˆåŠŸå¾Œåšä»€éº¼ï¼ˆä¾‹å¦‚é‡æ–°æ•´ç†æ¸…å–®ï¼‰

## ğŸ§  3. useQueryClient â€“ å¿«å–æ“ä½œå…¥å£

```tsx
const queryClient = useQueryClient();

queryClient.invalidateQueries(['todos']); // é‡æ–°å–å¾—
queryClient.setQueryData(['todos'], data); // æ‰‹å‹•è¨­è³‡æ–™
queryClient.getQueryData(['todos']); // æ‹¿å¿«å–è³‡æ–™
queryClient.removeQueries(['todos']); // æ¸…é™¤å¿«å–
```

## ğŸ§° 4. å¿«å–å‡½å¼å¸¸ç”¨å°ç…§è¡¨

| å‡½å¼                          | ç”¨é€”                     |
| ----------------------------- | ------------------------ |
| `invalidateQueries(['key'])`  | å¼·åˆ¶é‡æ–°å–å¾—             |
| `removeQueries(['key'])`      | æ¸…é™¤å¿«å–                 |
| `setQueryData(['key'], data)` | å¯«å…¥å¿«å–è³‡æ–™             |
| `getQueryData(['key'])`       | è®€å–å¿«å–è³‡æ–™ï¼ˆä¸æœƒé‡æŠ“ï¼‰ |

## ğŸ” 5. æ‰‹å‹• refetch è³‡æ–™

```tsx
const query = useQuery(...)
query.refetch() // æ‰‹å‹•é‡æ–°å–å¾—
```

æ­é…ï¼š

```tsx
useQuery({
  queryKey: ['data'],
  queryFn,
  enabled: false, // é è¨­ä¸æŠ“
});
```

## ğŸ“¦ 6. å…¨åŸŸåŒ…è£ï¼šQueryClientProvider

```tsx
import { QueryClient, QueryClientProvider } from '@tanstack/react-query'

const queryClient = new QueryClient()

<QueryClientProvider client={queryClient}>
  <App />
</QueryClientProvider>
```

> ä¸åŒ…æœƒå ±éŒ¯ï¼æ¯å€‹å°ˆæ¡ˆéœ€è¨­ä¸€æ¬¡ã€‚

## ğŸ”¥ Bonusï¼šé–‹ç™¼å°æŠ€å·§

- `refetchInterval: 5000` â†’ æ¯ 5 ç§’è‡ªå‹•æ›´æ–°
- `retry: 3` â†’ éŒ¯èª¤æœ€å¤šé‡è©¦ 3 æ¬¡
- `onError` / `onSettled` / `onSuccess` â†’ å®Œæ•´æ§åˆ¶æµç¨‹
- å¯èˆ‡ Zod + Zustand + è¡¨å–®æ•´åˆ

## âœ… æœ€å¸¸ç”¨ Hook å°ç…§æ¸…å–®

- **`useQuery()`**ï¼ˆhookï¼‰ï¼š  
  ç”¨ä¾†æŸ¥è©¢ä¼ºæœå™¨è³‡æ–™ï¼ˆGET è«‹æ±‚ï¼‰ï¼Œè‡ªå‹•è™•ç† loading/error/dataã€‚

- **`useMutation()`**ï¼ˆhookï¼‰ï¼š  
  ç”¨ä¾†é€å‡ºè³‡æ–™ï¼ˆPOST / PUT / DELETEï¼‰ï¼Œé©åˆè¡¨å–®é€å‡ºæˆ–åˆªé™¤æ“ä½œã€‚

- **`useQueryClient()`**ï¼ˆhookï¼‰ï¼š  
  å–å¾— QueryClient å¯¦ä¾‹ï¼Œå¯ç”¨ä¾†æ‰‹å‹•æ“ä½œå¿«å–ï¼Œä¾‹å¦‚é‡æ–°æŠ“è³‡æ–™ã€æ›´æ–°å¿«å–å…§å®¹ã€‚

- **`queryClient.invalidateQueries(['key'])`**ï¼ˆå‡½å¼ï¼‰ï¼š  
  æ¨™è¨˜æŸç­†å¿«å–ç‚ºéæœŸï¼Œæœƒè‡ªå‹•é‡æ–°å–å¾—è³‡æ–™ã€‚

- **`queryClient.setQueryData(['key'], data)`**ï¼ˆå‡½å¼ï¼‰ï¼š  
  æ‰‹å‹•è¨­å®šæŸç­†å¿«å–çš„å€¼ï¼ˆé€šå¸¸ç”¨æ–¼ optimistic UIï¼‰ã€‚

- **`queryClient.getQueryData(['key'])`**ï¼ˆå‡½å¼ï¼‰ï¼š  
  è®€å–ç•¶å‰å¿«å–å…§å®¹ï¼ˆä¸æœƒè§¸ç™¼é‡æŠ“ï¼‰ã€‚

- **`queryClient.removeQueries(['key'])`**ï¼ˆå‡½å¼ï¼‰ï¼š  
  å¾å¿«å–ä¸­ç§»é™¤æŒ‡å®šçš„è³‡æ–™ã€‚

- **`refetch()`**ï¼ˆå‡½å¼ï¼‰ï¼š  
  æ‰‹å‹•è§¸ç™¼ `useQuery()` å†æŠ“ä¸€æ¬¡è³‡æ–™ï¼ˆä¾‹å¦‚æŒ‰ä¸‹ã€Œé‡æ–°æ•´ç†ã€æŒ‰éˆ•æ™‚ï¼‰ã€‚

- **`<QueryClientProvider client={queryClient}>`**ï¼ˆå…ƒä»¶ï¼‰ï¼š  
  å°‡ React Query çš„åŠŸèƒ½æ³¨å…¥æ•´å€‹ Appï¼Œè®“ `useQuery`ã€`useMutation` èƒ½ä½¿ç”¨ã€‚
