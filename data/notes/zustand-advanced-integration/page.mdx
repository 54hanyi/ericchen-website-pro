---
title: 'Zustand é€²éšæ•´åˆï¼šMiddleware èˆ‡ React Query å¯¦æˆ°'
description: 'å­¸ç¿’å¦‚ä½•å°‡ Zustand æ­é… middleware ä½¿ç”¨ Devtools èˆ‡æ—¥èªŒï¼Œä¸¦èˆ‡ React Query æ•´åˆä»¥å€åˆ†ä¼ºæœå™¨èˆ‡æœ¬åœ°ç‹€æ…‹ã€‚'
tags: ['zustand', 'middleware', 'react-query', 'devtools', 'æ•´åˆæ•™å­¸']
date: '2025-06-17'
---

# âš™ï¸ Zustand é€²éšæ•´åˆï¼šMiddleware èˆ‡ React Query å¯¦æˆ°

Zustand é™¤äº†å¯ä»¥ç®¡ç†ç°¡å–®çš„å…±äº«ç‹€æ…‹ï¼Œä¹Ÿå¯ä»¥é€é middleware èˆ‡ React Query æ­é…ï¼Œè™•ç†æ›´å¤§å‹æ‡‰ç”¨çš„éœ€æ±‚ã€‚

## ğŸ§© ä¸€ã€Zustand + middlewareï¼ˆDevtools / æ—¥èªŒï¼‰

Zustand æ”¯æ´ middlewareï¼Œå¦‚ Devtoolsï¼ˆåµéŒ¯å·¥å…·ï¼‰èˆ‡ loggerï¼ˆæ—¥èªŒè¿½è¹¤ï¼‰ï¼Œæ–¹ä¾¿åœ¨é–‹ç™¼éç¨‹ä¸­è§€å¯Ÿç‹€æ…‹è®ŠåŒ–ã€‚

### ğŸ“¦ å®‰è£ Devtools

```bash
npm install zustand zustand/middleware
```

### âœ… ä½¿ç”¨ Devtools middleware

```ts
import { create } from 'zustand';
import { devtools } from 'zustand/middleware';

type CounterState = {
  count: number;
  increase: () => void;
};

export const useCounterStore = create<CounterState>()(
  devtools((set) => ({
    count: 0,
    increase: () => set((state) => ({ count: state.count + 1 })),
  }))
);
```

- âœ… é€™æ¨£åœ¨ç€è¦½å™¨é–‹å•Ÿ Redux DevTools å°±èƒ½è§€å¯Ÿç‹€æ…‹è®ŠåŒ–ã€‚
- å¯ä»¥è¨­å®š `name`ï¼š

```ts
devtools((set) => ({}), { name: 'CounterStore' });
```

### âœ… åŠ å…¥ logger middlewareï¼ˆåˆ—å‡ºæ¯æ¬¡è®Šå‹•ï¼‰

```ts
import { create } from 'zustand';
import { devtools, logger } from 'zustand/middleware';

export const useStore = create(
  logger(
    devtools((set) => ({
      count: 0,
      increase: () => set((state) => ({ count: state.count + 1 })),
    }))
  )
);
```

## ğŸ” äºŒã€Zustand + React Query æ•´åˆ

Zustand èˆ‡ React Query å¯ä»¥ä¸€èµ·ä½¿ç”¨ï¼Œå„è‡ªè² è²¬ä¸åŒçš„ç‹€æ…‹ä¾†æºï¼š

âœ… è¡¨å–®æ¬„ä½ã€æœ¬åœ° modalã€ç™»å…¥ç‹€æ…‹

å»ºè­°å·¥å…·ï¼šZustand

å±¬æ–¼ Client stateï¼ˆä¾†è‡ª UIã€å„²å­˜åœ¨æœ¬åœ°ï¼‰

âœ… API è«‹æ±‚è³‡æ–™ï¼ˆæ–‡ç« åˆ—è¡¨ã€ç”¨æˆ¶è³‡æ–™ï¼‰

å»ºè­°å·¥å…·ï¼šReact Query

å±¬æ–¼ Server stateï¼ˆä¾†è‡ªå¾Œç«¯ã€éœ€è¦å¿«å–èˆ‡åŒæ­¥ï¼‰

### âœ… ç¯„ä¾‹ï¼šç™»å…¥ç‹€æ…‹ç”¨ Zustandã€è³‡æ–™ç”¨ React Query

```ts
// authStore.ts
import { create } from 'zustand';

export const useAuthStore = create(() => ({
  isLoggedIn: false,
  username: '',
  login: (name: string) => set({ isLoggedIn: true, username: name }),
  logout: () => set({ isLoggedIn: false, username: '' }),
}));
```

```tsx
// ä½¿ç”¨è€…è³‡è¨Š + API æ¸…å–®
import { useAuthStore } from './authStore';
import { useQuery } from '@tanstack/react-query';
import axios from 'axios';

function UserDashboard() {
  const { username, isLoggedIn } = useAuthStore();

  const { data, isLoading } = useQuery({
    queryKey: ['posts'],
    queryFn: () => axios.get('/api/posts').then((res) => res.data),
    enabled: isLoggedIn, // ç™»å…¥å¾Œæ‰æŠ“
  });

  if (!isLoggedIn) return <p>è«‹å…ˆç™»å…¥</p>;
  if (isLoading) return <p>è¼‰å…¥ä¸­...</p>;

  return (
    <div>
      <h2>æ­¡è¿å›ä¾†ï¼Œ{username}</h2>
      <ul>
        {data.map((post) => (
          <li key={post.id}>{post.title}</li>
        ))}
      </ul>
    </div>
  );
}
```

## âœ… å°çµ

ğŸ”¹ UI æ§åˆ¶ã€ç™»å…¥ç‹€æ…‹ã€æœ¬åœ° flag
â¤ å±¬æ–¼ï¼šClient state
â¤ å»ºè­°å·¥å…·ï¼šZustand

ğŸ”¹ ä¼ºæœå™¨è³‡æ–™ã€API è³‡è¨Š
â¤ å±¬æ–¼ï¼šServer state
â¤ å»ºè­°å·¥å…·ï¼šReact Query

ğŸ”¹ åµéŒ¯ / æ—¥èªŒç›£æ§
â¤ å±¬æ–¼ï¼šmiddleware
â¤ å»ºè­°å·¥å…·ï¼šDevtools / logger

é€™æ¨£å¯ä»¥é”åˆ°ã€Œç‹€æ…‹åˆ†å±¤ã€ã€ã€Œè·è²¬åˆ†é›¢ã€çš„æœ€ä½³å¯¦å‹™ã€‚
