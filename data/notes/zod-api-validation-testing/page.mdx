---
title: 'Zod #7ï¼šAPI é©—è­‰èˆ‡æ¸¬è©¦å¯¦æˆ°'
description: 'ä»‹ç´¹å¦‚ä½•ä½¿ç”¨ Zod åœ¨å‰å¾Œç«¯ API é©—è­‰ä¸­å»ºç«‹å®‰å…¨çš„è³‡æ–™å…¥å£ï¼Œä¸¦é€²è¡Œå–®å…ƒæ¸¬è©¦èˆ‡é©—è­‰æµç¨‹è¨­è¨ˆã€‚'
tags: ['zod', 'api', 'é©—è­‰', 'æ¸¬è©¦']
date: '2025-06-17'
---

# ğŸ“˜ Zod #7ï¼šAPI é©—è­‰èˆ‡æ¸¬è©¦å¯¦æˆ°

Zod é™¤äº†å‰ç«¯è¡¨å–®é©—è­‰ï¼Œä¹Ÿå¯ç”¨æ–¼**å¾Œç«¯ API è³‡æ–™é©—è­‰ã€API Route middlewareã€æ¸¬è©¦é©—è­‰é‚è¼¯**ï¼Œæœ¬ç« å°‡ç¤ºç¯„ï¼š

## âœ… ç”¨ Zod é©—è­‰ API Request è«‹æ±‚å…§å®¹

ä¾‹å¦‚ï¼šä½ æœ‰ä¸€å€‹ä½¿ç”¨è€…è¨»å†Š APIï¼Œè¦é©—è­‰ req.body æ ¼å¼ï¼š

```ts
// schema.ts
import { z } from 'zod';

export const registerSchema = z.object({
  email: z.string().email(),
  password: z.string().min(6),
});
```

```ts
// route.ts (Next.js / Express / Hono å‡é©ç”¨)
import { registerSchema } from './schema';

app.post('/api/register', async (req, res) => {
  const parsed = registerSchema.safeParse(req.body);

  if (!parsed.success) {
    return res.status(400).json({ errors: parsed.error.format() });
  }

  // é©—è­‰æˆåŠŸï¼Œä½¿ç”¨ parsed.data
  const { email, password } = parsed.data;
  return res.json({ success: true });
});
```

## ğŸ§ª å° Schema æ’°å¯«æ¸¬è©¦

ä½ å¯ä»¥é‡å° Zod schema æ’°å¯«å–®å…ƒæ¸¬è©¦ï¼Œç¢ºä¿é©—è­‰é‚è¼¯æ­£ç¢ºï¼š

```ts
import { registerSchema } from './schema';

describe('registerSchema', () => {
  it('should pass with valid data', () => {
    const result = registerSchema.safeParse({
      email: 'test@example.com',
      password: 'Abcd1234',
    });
    expect(result.success).toBe(true);
  });

  it('should fail if email is invalid', () => {
    const result = registerSchema.safeParse({
      email: 'bademail',
      password: 'Abcd1234',
    });
    expect(result.success).toBe(false);
  });
});
```

## ğŸ’¡ é©—è­‰ API Query / Params / Headers

Zod ä¸åªèƒ½é©—è­‰ bodyï¼Œä¹Ÿå¯é©—è­‰ï¼š

- `z.string().uuid()`ï¼šé©—è­‰ `params.id` æ˜¯å¦ç‚º UUID
- `z.enum(['asc', 'desc'])`ï¼šé©—è­‰ `query.sort`
- `z.string().startsWith('Bearer ')`ï¼šé©—è­‰ headers çš„ token æ ¼å¼

```ts
const querySchema = z.object({
  sort: z.enum(['asc', 'desc']).default('asc'),
});
```

## âœ… å°çµ

- Zod å¯ç”¨æ–¼ API request é©—è­‰ï¼ˆbody/query/paramsï¼‰
- éŒ¯èª¤å›å‚³æ ¼å¼å¯ç”¨ `.format()` è£½ä½œå‹å–„è¼¸å‡º
- å¯æ­é…æ¸¬è©¦å·¥å…·æ’°å¯«å–®å…ƒæ¸¬è©¦ï¼ˆJestã€Vitest ç­‰ï¼‰
- é©åˆç”¨æ–¼å‰å¾Œç«¯å…±ç”¨ schemaã€é›†ä¸­é©—è­‰é‚è¼¯

ğŸ‘‰ ä¸‹ä¸€ç« ï¼Œæˆ‘å€‘å°‡ç¸½çµæ•´é«”æ‡‰ç”¨å ´æ™¯ï¼Œä¸¦ä»‹ç´¹ Zod èˆ‡å…¶ä»–é©—è­‰å·¥å…·ï¼ˆå¦‚ Yupã€Joiï¼‰çš„æ¯”è¼ƒã€‚
