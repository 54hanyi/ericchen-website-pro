---
title: 'Next.js 15 generateMetadata æ­£ç¢ºä½¿ç”¨ç­†è¨˜'
description: 'æ•´ç† Next.js App Router generateMetadata åœ¨å‹•æ…‹è·¯ç”±ä¸­çš„æ­£ç¢ºå‹åˆ¥èˆ‡è§£æ³•ï¼Œé¿å… build errorï¼Œæ”¯æ´ SEO og:image å‹•æ…‹ç”¢ç”Ÿã€‚'
tags: ['next.js', 'generateMetadata', 'App Router', 'TypeScript']
date: '2025-06-08'
---

# Next.js 15 `generateMetadata` æ­£ç¢ºä½¿ç”¨ç­†è¨˜

é€™ç¯‡ç­†è¨˜æ•´ç†åœ¨ Next.js App Router (`app/` ç›®éŒ„) ä½¿ç”¨ `generateMetadata` æ™‚ï¼Œå¸¸è¦‹çš„ TypeScript å‹åˆ¥éŒ¯èª¤èˆ‡æ­£ç¢ºè§£æ³•ï¼š

## ğŸŒŸ å¸¸è¦‹éŒ¯èª¤ç¾è±¡

```
Type '{ params: { slug: string; }; }' is missing the following properties from type 'Promise<any>': then, catch, finally, [Symbol.toStringTag]
```

- æ­¤éŒ¯èª¤å‡ºç¾åœ¨ `generateMetadata` æˆ– `Page` å‡½å¼ä¸­ï¼ŒåŸå› æ˜¯ **Next.js 15 åœ¨ App Router çš„å‹•æ…‹è·¯ç”± `params` è¢«è¨­è¨ˆæˆ Promise**ã€‚
- å‹åˆ¥ä¸æ­£ç¢ºï¼Œå°è‡´ build å¤±æ•—ã€‚

## ğŸ”§ å•é¡Œæ ¹å› 

1. æ²’æœ‰ç‚º `generateMetadata` æŒ‡å®šå›å‚³å‹åˆ¥ï¼š`Promise<Metadata>`ã€‚
2. `params` æ‡‰å®šç¾©ç‚º `Promise<{ slug: string }>`ï¼Œä¸”ä½¿ç”¨æ™‚æ‡‰è©² `await params`ã€‚
3. `Page` å‡½å¼èˆ‡ `generateMetadata` éœ€ä½¿ç”¨ç›¸åŒå‹åˆ¥ï¼Œé¿å…å‹åˆ¥ä¸ä¸€è‡´ã€‚

## â™»ï¸ æ­£ç¢ºåšæ³•

### 1. æŠ½å‡ºçµ±ä¸€å‹åˆ¥ `DynamicParams`

```ts
// types/params.ts
export type DynamicParams<K extends string> = {
  params: Promise<{
    [key in K]: string;
  }>;
};
```

### 2. ä½¿ç”¨ `DynamicParams` å‹åˆ¥

```ts
import { Metadata } from 'next';
import { DynamicParams } from '@/types/params';

export async function generateMetadata({ params }: DynamicParams<'slug'>): Promise<Metadata> {
  const { slug } = await params;
  return {
    title: `æ–‡ç«  - ${slug}`,
    description: `é—œæ–¼ ${slug} çš„ç­†è¨˜`,
  };
}

export default async function Page({ params }: DynamicParams<'slug'>) {
  const { slug } = await params;
  // ...
}
```

### 3. æœ¬æ©Ÿèˆ‡æ­£å¼ç’°å¢ƒ URL ç®¡ç†

åœ¨ `.env.local` è¨­å®šï¼š

```bash
NEXT_PUBLIC_SITE_URL=http://localhost:3000
```

åœ¨ Vercel Production è¨­å®š Environment Variableï¼š

```
NEXT_PUBLIC_SITE_URL=https://ä½ çš„æ­£å¼ç¶²åŸŸ
```

### 4. ç”Ÿæˆ og:image çš„å»ºè­°å¯«æ³•

```ts
const siteUrl = process.env.NEXT_PUBLIC_SITE_URL || 'http://localhost:3000';
const ogImageUrl = `${siteUrl}/api/og?title=${encodeURIComponent(title)}`;
```

## â€¼ï¸ é¡å¤–å»ºè­°

- `generateMetadata` å»ºè­°æ­é… Open Graphã€Twitter metadataï¼Œè‡ªå‹•ç”Ÿæˆç¤¾ç¾¤åˆ†äº«å¡ç‰‡è³‡è¨Šã€‚
- å‹åˆ¥ä¸€å®šè¦çµ±ä¸€ï¼Œé¿å… inline type èˆ‡å®šç¾© type ä¸ä¸€è‡´å°è‡´ build å‡ºéŒ¯ã€‚

## âœ… æœ€å¾Œç¸½çµ

| é …ç›®               | è¦æ±‚                                                   |
| :----------------- | :----------------------------------------------------- |
| `params`           | å®šç¾©ç‚º `Promise<{ slug: string }>`                     |
| `generateMetadata` | å®šç¾©ç‚º `async function` ä¸¦æ˜ç¢ºå›å‚³ `Promise<Metadata>` |
| `Page`             | èˆ‡ `generateMetadata` ä½¿ç”¨ç›¸åŒå‹åˆ¥                     |
| `Metadata`         | å¾ `next` å°å…¥æ­£ç¢ºå‹åˆ¥                                 |
| `og:image` URL     | ç”±ç’°å¢ƒè®Šæ•¸ `NEXT_PUBLIC_SITE_URL` å‹•æ…‹ç”Ÿæˆ             |

## ğŸ” å¯¦ç”¨ç¯„ä¾‹å›é¡§

```ts
export type DynamicParams<K extends string> = {
  params: Promise<{
    [key in K]: string;
  }>;
};
```

ä½¿ç”¨ï¼š

```ts
export async function generateMetadata({ params }: DynamicParams<'slug'>): Promise<Metadata> {
  const { slug } = await params;
  return { ... };
}

export default async function Page({ params }: DynamicParams<'slug'>) {
  const { slug } = await params;
  // ...
}
```
